# 手写体数字识别与其FPGA实现
> 通过学习 CNN 的原理、结构和数据处理过程，从模型优化和硬件加速两个方面进行 CNN 加速研究。模型优化方面，通过对 LeNet-5 模型进行结构优化和参数整型化，实现一个更适合在硬件平台实现的手写体数字识别模型 RLeNet。
## 适合硬件实现RLeNet模型结构
![WAF5@@{$)22$HH BGX)ENEU](https://user-images.githubusercontent.com/62864131/182316835-0fa92d57-6622-4ddb-8d75-940c8f5e1c75.png)
****************************
![5WH)9ZS%I`R)B3FL(KTYE72](https://user-images.githubusercontent.com/62864131/182316418-a4b25509-5582-4d9a-8dfd-cc301b68b593.png)

> 网络模型搭建完成后，下载 Mnist 数据集 60000 张数字图片对模型进行训练，并通过 Mnist 数据集 10000 测试集进行模型准确度测试，模型最终准确率为 98.4%，相比于LeNet-5，模型准确度几乎没有降低，由此可见，通过减少全连接层的数量降低模型的复杂度是可行的。

## 硬件加速设计以及并行运算实现
> * 卷积层并行
>   >为了实现卷积运算的并行设计，根据卷积算法的循环层数，逐层分析卷积运算过程，将卷积运算的并行设计分为滑窗内并行，多通道并行和多卷积核并行三个层次,如下图所示：    
>   >![E WZ6OU4_7%7RB$9E`)68PU](https://user-images.githubusercontent.com/62864131/182318408-d94c5293-c9b3-4d05-a5a0-05829623e05d.png)
> * 池化层并行
>   >池化运算共有五层循环，并行设计共分为两个层次，池化滑窗内并行和层间并行
>   >   >**池化滑窗内并行：** 池化滑窗内并行的目的是找出滑窗内数据的最大值。池化滑窗内并行的输入数据为池化滑窗，滑窗内数据相互独立，在比较滑窗内数据大小时，根据滑窗的大小，可以将滑窗内的数据两两并行进行比较，之后将前一次运算结果再次进行比较。滑窗内并行结构如下图所示。  
>   >   >**层间并行：** 最外层循环为输入的各个通道进行池化运算，各通道内数据相互独立，可以实现池化运算的多通道并行，多通道并行结构如下图所示。运算过程中滑窗在从左到右，从上到下依次滑动，输出结果包含先后顺序，所以在设计时，为了降低资源消耗，不采用并行设计。  
>   >   >![IF58240W_@K9DOZ 1E}XVZM](https://user-images.githubusercontent.com/62864131/182321303-8f23866b-e16d-4914-8d76-6d05537fab00.png)

*********************
> * 资源复用  
>   >本实验在进行硬件结构搭建时，采用资源复用策略，两层卷积共用同一个硬件加速结构，卷积运算共用同一个乘加单元，第一次卷积运算完成后，在第二次卷积运算时，数据会输入同一个卷积运算单元，实现卷积模块的硬件资源的复用。  
> * 定点量化  
>   >无损量化后各层输入输出参数位宽如下图所示：  
>   >![OX EX5ONTFY)C238(PG48`T](https://user-images.githubusercontent.com/62864131/182321338-3e8b1e2f-c4ff-4767-88f2-03a4209a217c.png)

## 加速器最终预测仿真结果
在硬件环境搭建完成之后，开始进行手写体数字图片的预测，步骤如下：    
(1) 打开网络摄像头，通过摄像头抓取数字图片，之后对抓取到的图片进行处理。    
(2) 打开串口，对串口进行配置，之后将处理好的图片数据通过串口自动发送到下位机。    
(3) 开发板通过按键中断控制 RLeNet 模型硬件加速器 IP 核 CNN IP，CNN IP 通过串口读取图片数据，进行预测，最后将预测结果通过七段数码管显示。通过按键中断控制 CNN IP，CNN IP 可以多次进行数据的读取。    
> **手写数字**  
> ![I(KGXRM~W Y (K 93NA}HVD](https://user-images.githubusercontent.com/62864131/182322186-b495386e-9f44-4251-88bf-a6780e6eeef7.png)  
*******************************************
> **PC分割后传入下位机识别结果**  
> ![4A2 ){4CHCW{A2G%%%A6A7I](https://user-images.githubusercontent.com/62864131/182322830-7a0f9172-8a45-4f54-b817-4c5f8e18dac0.png)



